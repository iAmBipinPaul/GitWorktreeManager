<DataTemplate xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
              xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    
    <DataTemplate.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </DataTemplate.Resources>
    
    <Grid MinWidth="400" Margin="16" Background="Transparent">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Dialog Title -->
        <TextBlock Grid.Row="0" 
                   Text="Add New Worktree" 
                   FontSize="16" 
                   FontWeight="SemiBold"
                   Margin="0,0,0,16"
                   Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>

        <!-- Branch Name Input -->
        <StackPanel Grid.Row="1" Margin="0,0,0,12">
            <TextBlock Text="Branch Name:" 
                       Margin="0,0,0,4"
                       Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
            <TextBox Text="{Binding BranchName, Mode=TwoWay}"
                     Padding="6,4"
                     ToolTip="Enter the name of the branch to checkout or create"/>
        </StackPanel>

        <!-- Create New Branch Checkbox -->
        <CheckBox Grid.Row="2" 
                  Content="Create new branch (if it doesn't exist)"
                  IsChecked="{Binding CreateNewBranch, Mode=TwoWay}"
                  Margin="0,0,0,12"
                  Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"
                  ToolTip="Check this to create a new branch with the specified name"/>

        <!-- Worktree Location Input -->
        <StackPanel Grid.Row="3" Margin="0,0,0,12">
            <TextBlock Text="Worktree Location:" 
                       Margin="0,0,0,4"
                       Foreground="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBox Grid.Column="0"
                         Text="{Binding WorktreePath, Mode=TwoWay}"
                         Padding="6,4"
                         ToolTip="Enter or browse for the folder where the worktree will be created"/>
                <Button Grid.Column="1"
                        Content="Browse..."
                        Command="{Binding BrowseFolderCommand}"
                        Padding="12,4"
                        Margin="8,0,0,0"/>
            </Grid>
        </StackPanel>

        <!-- Validation Error Message -->
        <Border Grid.Row="4" 
                Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
                BorderBrush="OrangeRed"
                BorderThickness="1"
                Padding="8"
                Margin="0,0,0,16"
                Visibility="{Binding HasValidationError, Converter={StaticResource BoolToVis}}">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Error: " Foreground="OrangeRed" FontWeight="Bold"/>
                <TextBlock Text="{Binding ValidationError}" 
                           Foreground="OrangeRed"
                           TextWrapping="Wrap"/>
            </StackPanel>
        </Border>

        <!-- Dialog Buttons -->
        <StackPanel Grid.Row="5" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right">
            <Button Content="OK"
                    Command="{Binding OkCommand}"
                    IsEnabled="{Binding IsValid}"
                    Padding="20,6"
                    Margin="0,0,8,0"
                    MinWidth="80"/>
            <Button Content="Cancel"
                    Command="{Binding CancelCommand}"
                    Padding="20,6"
                    MinWidth="80"/>
        </StackPanel>
    </Grid>
</DataTemplate>
