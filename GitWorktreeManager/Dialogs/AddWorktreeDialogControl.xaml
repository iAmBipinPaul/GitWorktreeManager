<DataTemplate xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
              xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
              xmlns:vs="http://schemas.microsoft.com/visualstudio/extensibility/2022/xaml"
              xmlns:styles="clr-namespace:Microsoft.VisualStudio.Shell;assembly=Microsoft.VisualStudio.Shell.15.0"
              xmlns:colors="clr-namespace:Microsoft.VisualStudio.PlatformUI;assembly=Microsoft.VisualStudio.Shell.15.0">
    
    <Grid MinWidth="500">
        <Grid.Resources>
            <BooleanToVisibilityConverter x:Key="BoolToVis"/>
            <Style TargetType="Button" BasedOn="{StaticResource {x:Static styles:VsResourceKeys.ButtonStyleKey}}" />
            <Style TargetType="TextBox" BasedOn="{StaticResource {x:Static styles:VsResourceKeys.TextBoxStyleKey}}" />
            <Style TargetType="ComboBox" BasedOn="{StaticResource {x:Static styles:VsResourceKeys.ComboBoxStyleKey}}" />
            <Style TargetType="CheckBox" BasedOn="{StaticResource {x:Static styles:VsResourceKeys.CheckBoxStyleKey}}" />
            <Style TargetType="TextBlock">
                <Setter Property="Foreground" Value="{DynamicResource {x:Static styles:VsBrushes.WindowTextKey}}" />
            </Style>
        </Grid.Resources>
        
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Create New Branch Checkbox - FIRST -->
        <CheckBox Grid.Row="0" 
                  Content="Create new branch"
                  IsChecked="{Binding CreateNewBranch, Mode=TwoWay}"
                  Margin="0,0,0,16"
                  ToolTip="Check to create a new branch, uncheck to use an existing branch"/>

        <!-- Branch Name Input (only when creating new branch) -->
        <Grid Grid.Row="1" Margin="0,0,0,16" Visibility="{Binding CreateNewBranch, Converter={StaticResource BoolToVis}}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="100"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" 
                       Text="Branch name:" 
                       VerticalAlignment="Center"/>
            <TextBox Grid.Column="1"
                     Text="{Binding BranchName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                     Padding="8,6"
                     ToolTip="Enter the name for the new branch (e.g., feature/my-work)"/>
        </Grid>

        <!-- Based On / Select Branch Row -->
        <Grid Grid.Row="2" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="100"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" 
                       Text="{Binding BranchSelectorLabel}" 
                       VerticalAlignment="Center"/>
            <ComboBox Grid.Column="1"
                      ItemsSource="{Binding AvailableBranches}"
                      SelectedItem="{Binding SelectedBranch, Mode=TwoWay}"
                      Padding="8,6"
                      ToolTip="{Binding BranchSelectorTooltip}"/>
        </Grid>

        <!-- Validation Error -->
        <Border Grid.Row="3" 
                Background="#442222"
                Padding="8"
                Margin="0,0,0,16"
                Visibility="{Binding HasValidationError, Converter={StaticResource BoolToVis}}">
            <TextBlock Text="{Binding ValidationError}" 
                       Foreground="#F48771"
                       TextWrapping="Wrap"/>
        </Border>

        <!-- Buttons -->
        <StackPanel Grid.Row="4" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right">
            <Button Content="Create"
                    Command="{Binding OkCommand}"
                    IsEnabled="{Binding IsValid}"
                    Padding="20,8"
                    Margin="0,0,8,0"
                    MinWidth="90"/>
            <Button Content="Cancel"
                    Command="{Binding CancelCommand}"
                    Padding="20,8"
                    MinWidth="90"/>
        </StackPanel>
    </Grid>
</DataTemplate>
